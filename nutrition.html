<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutrition Mission | Robb Garden</title>
  <style>
    :root{ --bg:#f6f5f0; --ink:#1f2a1e; --muted:#5c6b5f; --brand:#2f7d32; --brand-2:#ffb74d; --card:#fff; --ring:#2f7d32; --radius:14px; --shadow:0 10px 25px rgba(0,0,0,.07); --shadow-sm:0 6px 14px rgba(0,0,0,.06); --maxw:1120px; }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:var(--ink);background:radial-gradient(1200px 800px at 90% -10%, rgba(47,125,50,.08), transparent 60%), var(--bg)}
    a{color:inherit;text-decoration:none} img{max-width:100%;display:block}
    .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.2) blur(8px);background:color-mix(in srgb,var(--bg) 84%,white);border-bottom:1px solid rgba(0,0,0,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand-badge{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#3ca34e);box-shadow:var(--shadow-sm)}
    .button{padding:10px 14px;border-radius:12px;background:var(--brand);color:#fff;font-weight:600;box-shadow:0 6px 14px rgba(47,125,50,.2)}
    h1{font-size:clamp(1.6rem,3.4vw,2.6rem);margin:22px 0 8px}
    .lead{color:var(--muted);margin:0 0 22px}
    .section{padding:56px 0}
    .grid{display:grid;gap:18px;grid-template-columns:repeat(12,1fr)}
    .span-4{grid-column:span 4} .span-6{grid-column:span 6} @media(max-width:900px){.span-4,.span-6{grid-column:1/-1}}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:clip;transition:.12s;display:grid;grid-template-rows:auto 1fr auto}
    .card:hover{transform:translateY(-3px);box-shadow:0 14px 30px rgba(0,0,0,.1)}
    .card .media{aspect-ratio:16/9;background:#e5efe6;overflow:hidden}
    .card .media img{width:100%;height:100%;object-fit:cover;display:block}
    .card .body{padding:18px}
    .tag{font-size:.85rem;padding:6px 10px;border-radius:999px;background:#eef7ef;color:var(--brand);border:1px solid #dff0e1}
    footer{padding:32px 0;color:var(--muted);border-top:1px solid rgba(0,0,0,.08);margin-top:28px}
  </style>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><img src="assets/images/Sustainability-Lockup-Responsive-Orange1.png" alt="Sustainability Department Logo" style="height:60px; display:block;" /></div>
      <nav><a class="button" href="index.html">Home</a></nav>
    </div>
  </header>

  <main class="container">
    <h1>Nutrition Mission</h1>
    <p class="lead">Evidence-based micronutrient profiles, simple recipes, and storage tips to help students eat well on a budget.</p>

    <!-- Color-coded produce overview -->
    <section class="section">
      <div class="grid">
        <article class="card span-6">
          <div class="media">
            <img src="assets/images/veg.jpeg" alt="Freshly harvested vegetables and leafy greens" loading="lazy" />
          </div>
          <div class="body">
            <h2>Why it matters</h2>
            <p>We publish per-100 g and per-cup nutrient values with sources (USDA/MyFoodData), plus retaining-nutrients tips.</p>
            <div style="margin-top:10px" class="tag">Micronutrients</div>
          </div>
        </article>
        <article class="card span-6">
          <div class="media">
            <img src="assets/images/meal1.jpeg" alt="Students preparing a meal with garden produce" loading="lazy" />
          </div>
          <div class="body">
            <h2>How to use this guide</h2>
            <p>Browse produce by color or nutrient focus. Each profile includes quick prep, storage, and zero-waste tips.</p>
            <div style="margin-top:10px" class="tag">Student-friendly</div>
          </div>
        </article>
      </div>
    </section>

    <!-- Red Produce Nutrition Section -->
    <section class="section" id="red-produce">
      <h2>Red Produce Nutrition Data</h2>
      <div class="card" style="padding:16px;">
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:12px;">
          <label for="redSelect"><strong>Select red produce:</strong></label>
          <select id="redSelect" style="padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff;"></select>
        </div>
        <div style="overflow:auto;">
          <table id="redTable" style="width:100%; border-collapse:separate; border-spacing:0 8px;">
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <script>
      (function(){
        const SELECT_ID = 'redSelect';
        const TABLE_ID = 'redTable';

        const LABELS = {
          A_RAE_mcg: 'Vitamin A (RAE) (mcg)',
          B1_mg: 'Vitamin B1 (Thiamin) (mg)',
          B6_mg: 'Vitamin B6 (mg)',
          B9_mcg: 'Folate (mcg)',
          B12_mcg: 'Vitamin B12 (mcg)',
          C_mg: 'Vitamin C (mg)',
          Choline_mg: 'Choline (mg)',
          D_IU: 'Vitamin D (IU)',
          Iron_mg: 'Iron (mg)',
          Magnesium_mg: 'Magnesium (mg)',
          Potassium_mg: 'Potassium (mg)',
          Selenium_mcg: 'Selenium (mcg)',
          Zinc_mg: 'Zinc (mg)',
          Omega3_g: 'Omega-3 (g)'
        };
        const ORDER = ['C_mg','Iron_mg','Magnesium_mg','Potassium_mg','Zinc_mg','Selenium_mcg','Choline_mg','B1_mg','B6_mg','B9_mcg','B12_mcg','A_RAE_mcg','D_IU','Omega3_g'];

        function createRow(label, value){
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td style="padding:10px 12px; background:#fff; border:1px solid rgba(0,0,0,.06); border-right:none; border-radius:10px 0 0 10px; font-weight:600">${label}</td>
            <td style="padding:10px 12px; background:#fff; border:1px solid rgba(0,0,0,.06); border-left:none; border-radius:0 10px 10px 0; text-align:right">${value}</td>`;
          return tr;
        }

        function render(item){
          const tbody = document.querySelector('#'+TABLE_ID+' tbody');
          tbody.innerHTML = '';
          const nutrients = item.nutrients || {};

          // Sort keys by preferred ORDER, then any extras
          const keys = Object.keys(nutrients).sort((a,b)=>{
            const ai = ORDER.indexOf(a), bi = ORDER.indexOf(b);
            if(ai === -1 && bi === -1) return a.localeCompare(b);
            if(ai === -1) return 1;
            if(bi === -1) return -1;
            return ai - bi;
          });

          if(keys.length === 0){
            tbody.appendChild(createRow('No nutrient data available', '—'));
            return;
          }

          keys.forEach(k=>{
            const raw = nutrients[k];
            const isNumber = typeof raw === 'number' && !Number.isNaN(raw);
            const val = isNumber ? (Math.abs(raw) >= 10 ? raw.toFixed(0) : raw.toFixed(2)) : String(raw);
            const label = LABELS[k] || k.replace(/_/g,' ');
            tbody.appendChild(createRow(label, val));
          });
        }

        async function init(){
          try{
            const res = await fetch('data/nutrients.json', {cache:'no-store'});
            const all = await res.json();
            const redProduce = all.filter(p => p.color && p.color.toLowerCase() === 'red');

            if(!redProduce.length){
              const tbody = document.querySelector('#'+TABLE_ID+' tbody');
              tbody.innerHTML = '<tr><td class="lead">No red produce found in data/nutrients.json</td></tr>';
              return;
            }

            const select = document.getElementById(SELECT_ID);

            redProduce.forEach((it, i)=>{
              const opt = document.createElement('option');
              opt.value = i;
              opt.textContent = it.name;
              select.appendChild(opt);
            });

            if(redProduce.length > 0){
              select.value = "0";
              render(redProduce[0]);
              select.addEventListener('change', ()=> render(redProduce[Number(select.value)]));
            }
          } catch(e){
            console.error(e);
            const tbody = document.querySelector('#'+TABLE_ID+' tbody');
            tbody.innerHTML = '<tr><td class="lead">Couldn’t load nutrients.json — please run a local server.</td></tr>';
          }
        }

        init();
      })();
    </script>
  </main>

  <footer>
    <div class="container">
      <strong>Robb Garden</strong><br />
      <span class="lead">Student-led sustainable agriculture at University of the Pacific.</span>
    </div>
  </footer>
</body>
</html>
